<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="caoye"><link rel="alternative" href="/atom.xml" title="Zoor" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>Cocoapods镜像制作 - Zoor</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0;"><header class="head"><h1 class="head-title u-fl"><a href="/">Zoor</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">博客目录</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2017-11-18T14:58:54.000Z">November 18, 2017</time><h1 class="post__title"><a href="/2017/11/18/Cocoapods镜像制作/">Cocoapods镜像制作</a></h1><div class="post__main echo"><p>项目开发过程中避免不了使用第三方，常用的第三方包管理工具有<code>Carthage</code>、<code>Package Manager</code>、<code>Cocoapods</code>,目前为止<code>Cocoapods</code>的使用范围比较广，由于是从远程仓库托管到了github上，导致拉取更新比较慢，尤其是用<code>Cocoapods</code>做项目插件化的项目， <code>pod update</code>、<code>pod install</code>的频率比较高，制作一套自己的<code>Cocoapods</code>镜像是比较合适的选择。</p>
<p>先说一下我自己的方案：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我们都知道`Cocoapods `的repo被托管到了github，我们可以将它克隆到本地，把这个</span><br><span class="line">repo定时更新并推到自己服务器上，把项目中依赖的源修改成我们自己服务器上镜像地址。</span><br></pre></td></tr></table></figure></p>
<p>我们先安装<a href="https://cocoapods.org" target="_blank" rel="noopener">Cocoapods</a>，安装方法可参考其他博文的<a href="http://www.jianshu.com/p/f43b5964f582" target="_blank" rel="noopener">安装方法</a></p>
<ol>
<li>我们先拉取官方库裸库到本地<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git --bare https://github.com/CocoaPods/Specs.git</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>push镜像到我们自己git服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push --mirror git@code.ds.gome.com.cn:Aeromind-iOS/Specs.git</span><br></pre></td></tr></table></figure>
<p>我们通过命令打开本地repo仓库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/.cocoapods/repos</span><br><span class="line">$ open .</span><br></pre></td></tr></table></figure></p>
<p>会发现存在一个<code>master</code>分支的仓库,在这个<code>master</code>这个仓库里我们能看到fetch和push的地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v</span><br><span class="line">结果:</span><br><span class="line">origin    https://github.com/CocoaPods/Specs.git (fetch)</span><br><span class="line">origin    https://github.com/CocoaPods/Specs.git (push)</span><br></pre></td></tr></table></figure></p>
<p>我们看到这个库的fetch和push的地址都是github，我们要把这个master分之作为一个官方库和我们自己服务器镜像库同步的一个桥梁，那么我们接下来需要做一些工作</p>
<p>进入master文件夹，其中有个隐藏文件<code>.git</code>，我们可以通过显示隐藏文件或者命令找到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/.cocoapods/repos/master/.git</span><br><span class="line">$ open .</span><br></pre></td></tr></table></figure></p>
<p>在里面会发现有个<code>config</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi config</span><br></pre></td></tr></table></figure></p>
<p>我们需要在config文件中将push的地址变为我们自己服务器的地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[core]</span><br><span class="line">repositoryformatversion = 0</span><br><span class="line">filemode = true</span><br><span class="line">bare = false</span><br><span class="line">logallrefupdates = true</span><br><span class="line">ignorecase = true</span><br><span class="line">precomposeunicode = true</span><br><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">url = https://github.com/CocoaPods/Specs.git</span><br><span class="line">fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">[branch &quot;master&quot;]</span><br><span class="line">remote = origin</span><br><span class="line">merge = refs/heads/master</span><br><span class="line">pushurl = git@code.ds.code.gome.com.cn:Aeromin-iOS/Specs.git</span><br></pre></td></tr></table></figure></p>
<p>在master分支再次查看远端地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v</span><br><span class="line">结果：</span><br><span class="line">origin    https://github.com/CocoaPods/Specs.git (fetch)</span><br><span class="line">origin    git@code.ds.code.gome.com.cn:Aeromin-iOS/Specs.git (push)</span><br></pre></td></tr></table></figure></p>
<p>OK，这要我们修改成功了，我们接下来需要做的事就定时去拉取github上的更新，并push到我们自己的服务器上。</p>
<p>我是在github上配置了ssh，建议自己git服务器和github都配上ssh，这样git不会受密码变动影响。</p>
<p>接下来开始写个简单定时任务脚本<br>创建一个<code>mirror_sync.sh</code>的文件，然后将这个文件变成可执行文件，文件内容为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># !/bin/sh</span><br><span class="line"></span><br><span class="line">cd ~/.cocoapods/repos/master</span><br><span class="line">git pull origin master</span><br><span class="line">echo &apos;\033[31m ********* pull finish ^_^ ******** \033[0m&apos;</span><br><span class="line">git push --mirror</span><br><span class="line">echo &apos;\033[31m ********* push finish ^_^ ******** \033[0m&apos;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod +x mirror_sync.sh</span><br></pre></td></tr></table></figure>
<p>创建一个log文件<code>mirror_sync.log</code>存储log</p>
<p>添加crontab定时任务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ crontab -e</span><br><span class="line">添加内容：</span><br><span class="line">* */2 * * * ~/mirror_shell/mirror_sync.sh &gt; ~/mirror_shell/mirror_sync.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure></p>
<p>两小时更新一次，这样镜像就基本制作完毕了。</p>
<p>最后使用的时候我们需要在<code>podfile</code>里把源替换掉<br><img src="http://upload-images.jianshu.io/upload_images/9045592-13790b0eaa2057ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照"></p>
</div></header></article><div class="comments" id="lv-container" data-id="city" data-uid="your uid"><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2016-2017 caoye</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>